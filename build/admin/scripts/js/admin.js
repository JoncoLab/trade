"use strict";var main=function(){var e=$(".navbar").height(),t=$("main"),a=$("table.users, table.lots"),n=$("header .navbar button"),i=$(".users td.ver"),r=i.children(".verification-form"),s=$(".users td.delete .delete-button"),o=$(".lots td.delete .delete-button"),l=$("#upload"),c=$("#clear-lots"),p={nextSession:$("#set-next-session"),adminPass:$("#set-admin-pass")},d=function(e){var t=$("#loading");switch(e){case!0:t.show(0,function(){t.css({display:"flex"})});break;case!1:t.hide();break;default:alert("Сталася помилка! Сторінку буде перезавантажено!"),window.location.reload()}},u=function(e,t){d(!0),$.ajax({url:"scripts/php/admin-settings.php",method:"POST",data:{function:e,input:t},success:function(){alert("Налаштування змінено!")},error:function(){alert("Щось пішло не так! Налаштування не було змінено!")},complete:function(){d(!1)}})},h=$("form .content"),f=h.children(".add-paragr"),v=$(".trade");t.css("margin-top",e+20+"px"),a.DataTable({iDisplayLength:10}),n.click(function(){var e=$(".page-maker"),t=$('[id$="_wrapper"]'),a=$(this).attr("id"),n=$("#DataTables_Table_1_wrapper"),i=$("#DataTables_Table_0_wrapper");switch(e.hide(),t.hide(),$("."+a).toggle(),a){case"users":n.show();break;case"lots":i.show()}}),p.nextSession.submit(function(e){var t=$("#next-session").val();e.preventDefault(),u("nextSession",t)}),p.adminPass.submit(function(){var e=$("#admin-pass").val();event.preventDefault(),u("adminPass",e)}),l.change(function(){var e=this.files[0];if(e.name.length>0){var t=new FormData;t.append("lots",e),d(!0),$.ajax({url:"scripts/php/admin-upload-lots.php",method:"POST",data:t,contentType:!1,processData:!1,success:function(){alert("Лоти успішно оновлено!")},error:function(){alert("Проблема з файлом! Таблицю не буде оновлено!")},complete:function(){d(!1)}}),l.val("")}else alert("Ви не вибрали файл, таблицю не буле оновлено!"),d(!1)}),c.click(function(){d(!0),$.ajax({url:"scripts/php/admin-clear-lots.php",success:function(){alert("Таблицю лотів успішно очищено!")},error:function(){alert("Виникла проблема. Не вдалося очистити лоти.")},complete:function(){d(!1)}})}),r.on("submit",function(e){var t=$(this).parents("td"),a=t.siblings(".id").text(),n=$(this).children(".set-trader-id").val(),i=$("body");return d(!0),$.ajax({url:"scripts/php/admin-verify.php",dataType:"html",method:"POST",data:{id:a,traderId:n},success:function(e){d(!1),i.prepend(e)},error:function(){d(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()}}),e.preventDefault()}),s.click(function(){var e=$(this).parent().siblings(".id").text(),t=$(this).parentsUntil("tbody");d(!0),$.ajax({url:"scripts/php/admin-delete-user.php",data:{userId:e},method:"post",error:function(){d(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){d(!1),t.remove()}})}),o.click(function(){var e=$(this).parent().siblings(".id").text(),t=$(this).parentsUntil("tbody");d(!0),$.ajax({url:"scripts/php/admin-delete-lot.php",data:{lotId:e},method:"post",error:function(){d(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){d(!1),t.remove()}})}),f.click(function(){var e=$(".content textarea").val(),t=h.children("textarea"),a=$(".clear"),n=$(".watch");""!==e&&(h.append('<div class="new-paragr"><button class="remove-paragr" type="button">Стерти</button><button class="edit-paragr" type="button">Редаг</button><button type="button" class="edited">OK</button><p class="paragraph">'+e+"</p></div>"),t.val(""));var i=$(".content .new-paragr"),r=i.children(".edit-paragr"),s=i.children(".edited"),o=i.children(".remove-paragr");a.click(function(){t.val("")}),r.unbind().on("click",function(){var e=$(this),t=e.siblings("p").html(),a=e.siblings("textarea, p"),n=e.siblings(".edited");a.remove(),e.parent().prepend('<textarea autofocus rows="12" tabindex="1">'+t+"</textarea>"),e.hide(),n.show(),e.siblings("textarea").focus()}),s.click(function(){var e=$(this),t=e.siblings("textarea").text();""!==t&&(e.siblings("p").remove(),e.parent().append("<p>"+t+"</p>"),e.hide(),e.siblings("textarea").remove(),e.siblings(".edit-paragr").show())}),o.click(function(){$(this).parent().remove()}),n.on("click",function(){var e=$("#header"),t=e.val(),a="<h2>"+t+"</h2>",n="";if(i.each(function(){n=n+"<p>"+$(this).children("p").html()+"</p>"}),0!==i.length&&""!==t){var r="<article class='preview'><span class='back' style='color: grey; float: right;'>Повернутись - подвійний клік по статті</span>"+a+n+"</article>",s=$("article.preview"),o=$("fieldset");o.hide(),s.remove(),$("form.write-article").append(r)}else if(""==t)return e.toggleClass("error"),!1;$("article").focus(),s.dblclick(function(){$(this).remove(),o.show()})})}),v.submit(function(e){var t=$(this).find(".form-item"),a=t.has("input:checked"),n=$("#sellers"),i=a.length;if(0==i)alert("Жодного продавця не вибрано!"),e.preventDefault();else{var r="";a.each(function(e){r+=$(this).children(".seller").text(),e!=i-1&&(r+=",")}),n.val(r)}})};$(document).ready(main);