"use strict";var main=function(){var t=$(".navbar").height(),e=$("main"),a=$("table.users, table.lots"),i=$("header .navbar button"),n=$(".users td.ver"),s=n.children(".verification-form"),l=$(".users td.delete .delete-button"),r=$(".users td.delete .cancel-verification-button"),c=$("#cancel"),o=$(".users td.access button.allow-access"),d=$(".users td.access button.deny-access"),p=$(".lots td.delete .delete-button"),u=$("#upload"),h=$("#clear-lots"),f=$("#download"),m=$("#total"),v=$("#total-verified"),b={nextSession:$("#set-next-session"),adminPass:$("#set-admin-pass"),applicationTemplate:$("#application-template"),timer:$("#set-timer"),to:$("#set-to")},x=function(t){var e=$("#loading");switch(t){case!0:e.show(0,function(){e.css({display:"flex"})});break;case!1:e.hide();break;default:alert("Сталася помилка! Сторінку буде перезавантажено!"),window.location.reload()}},y=function(t,e){x(!0),$.ajax({url:"scripts/php/admin-settings.php",method:"POST",data:{function:t,input:e},success:function(){alert("Налаштування змінено!")},error:function(){alert("Щось пішло не так! Налаштування не було змінено!")},complete:function(){x(!1)}})},w=$(".trade");e.css("margin-top",t+20+"px"),a.DataTable({iDisplayLength:10}),i.click(function(){var t=$(".page-maker"),e=$('[id$="_wrapper"]'),a=$(this).attr("id"),i=$("#DataTables_Table_1_wrapper"),n=$("#DataTables_Table_0_wrapper");switch(t.hide(),e.hide(),$("."+a).toggle(),a){case"users":i.show();break;case"lots":n.show()}}),b.nextSession.submit(function(t){var e=$("#next-session").val();t.preventDefault(),y("nextSession",e)}),b.adminPass.submit(function(t){var e=$("#admin-pass").val();t.preventDefault(),y("adminPass",e)}),b.applicationTemplate.change(function(){var t=this.files[0];if(t.name.length>0){var e=new FormData;e.append("application",t),x(!0),$.ajax({url:"scripts/php/admin-upload-application.php",method:"POST",data:e,contentType:!1,processData:!1,success:function(){alert("Шаблон заявки успішно оновлено!")},error:function(){alert("Проблема з файлом! Таблицю не буде оновлено!")},complete:function(){x(!1)}}),uploadApplicationTemplateInput.val("")}else alert("Ви не вибрали файл, шаблон заявки не буле оновлено!"),x(!1)}),b.timer.submit(function(t){var e=$("#timer").val();t.preventDefault(),y("timer",e)}),b.to.submit(function(t){var e=$("#to").val();t.preventDefault(),y("to",e)}),u.change(function(){var t=this.files[0];if(t.name.length>0){var e=new FormData;e.append("lots",t),x(!0),$.ajax({url:"scripts/php/admin-upload-lots.php",method:"POST",data:e,contentType:!1,processData:!1,success:function(){alert("Лоти успішно оновлено!")},error:function(){alert("Проблема з файлом! Таблицю не буде оновлено!")},complete:function(){x(!1)}}),u.val("")}else alert("Ви не вибрали файл, таблицю не буле оновлено!"),x(!1)}),h.click(function(){x(!0),$.ajax({url:"scripts/php/admin-clear-lots.php",success:function(){alert("Таблицю лотів успішно очищено!")},error:function(){alert("Виникла проблема. Не вдалося очистити лоти.")},complete:function(){x(!1)}})}),f.click(function(){window.location.replace("scripts/php/admin-download-lots.php")}),s.on("submit",function(t){var e=$(this).parents("td"),a=e.siblings(".id").text(),i=$(this).children(".set-trader-id").val(),n=e.siblings(".delete").children(".cancel-verification-button"),s=e.siblings(".access").children(".allow-access"),l=$("body");return x(!0),$.ajax({url:"scripts/php/admin-verify.php",dataType:"html",method:"POST",data:{id:a,traderId:i},success:function(t){x(!1),l.prepend(t),n.removeAttr("disabled"),s.removeAttr("disabled")},error:function(){x(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()}}),t.preventDefault()}),l.click(function(){var t=$(this).parent().siblings(".id").text(),e=$(this).parentsUntil("tbody"),a=e.siblings(".ver").text();x(!0),$.ajax({url:"scripts/php/admin-delete-user.php",data:{userId:t},method:"post",error:function(){x(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){x(!1),e.remove(),m.text(parseInt(m.text()-1)),"Верифікований"==a&&v.text(parseInt(v.text())-1)}})}),r.click(function(){var t=$(this);if(!t.is(":disabled")){var e=t.parentsUntil("tbody"),a=e.children(".id").text(),i=e.children(".trader-id"),n=i.text(),s=e.children(".ver"),l=e.children(".access"),r=e.children(".applied-for-lots"),c=$(".lots td.customers-applied");x(!0),$.ajax({url:"scripts/php/admin-cancel-verification.php",method:"POST",data:{id:a,traderId:n},success:function(){i.empty(),r.empty(),s.html('<form class="verification-form" onsubmit="verify($(this));"><input type="text" name="set-trader-id" class="set-trader-id" maxlength="4" pattern="[0-9]{3}" placeholder="Реєстр. №"><label class="verify">Верифікувати<input style="display: none;" type="submit" name="submit" value="verify"></label></form>'),l.html('<button disabled onclick="allowAccess($(this));" class="allow-access">Допустити</button>'),v.text(parseInt(v.text())-1),t.attr("disabled","disabled"),c.each(function(){var t=$(this),e=t.text(),a=function(t){return t!=n};e=e.split(", "),e=e.filter(a),e=e.join(", "),t.text(e)})},error:function(){alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},complete:function(){x(!1)}})}}),c.click(function(){var t=$(".users td.trader-id"),e=$(".users td.ver"),a=$(".users td.delete .cancel-verification-button"),i=$(".users td.applied-for-lots"),n=$(".users td.access"),s=$(".lots td.customers-applied");x(!0),$.ajax({url:"scripts/php/admin-cancel-all-verifications.php",success:function(){t.empty(),i.empty(),s.empty(),e.html('<form class="verification-form" onsubmit="verify($(this));"><input type="text" name="set-trader-id" class="set-trader-id" maxlength="4" pattern="[0-9]{3}" placeholder="Реєстр. №"><label class="verify">Верифікувати<input style="display: none;" type="submit" name="submit" value="verify"></label></form>'),n.html('<button disabled onclick="allowAccess($(this));" class="allow-access">Допустити</button>'),v.text("0"),a.attr("disabled","disabled")},error:function(){alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},complete:function(){x(!1)}})}),o.on("click",function(){if(!$(this).is(":disabled")){var t=$(this).parentsUntil("tbody"),e=t.children(".id").text(),a=t.children(".access");x(!0),$.ajax({url:"scripts/php/admin-allow-access.php",method:"POST",data:{id:e},dataType:"html",success:function(t){a.html(t),alert("Користувача успішно допущено до торгів.")},error:function(){alert("Не вдалося з'єднатися з базою даних!")},complete:function(){x(!1)}})}}),d.on("click",function(){var t=$(this).parentsUntil("tbody"),e=t.children(".id").text(),a=t.children(".access");x(!0),$.ajax({url:"scripts/php/admin-deny-access.php",method:"POST",data:{id:e},dataType:"html",success:function(t){a.html(t),alert("Користувачу заборонено доступ до торгів.")},error:function(){alert("Не вдалося з'єднатися з базою даних!")},complete:function(){x(!1)}})}),p.click(function(){var t=$(this).parent().siblings(".id").text(),e=$(this).parentsUntil("tbody");x(!0),$.ajax({url:"scripts/php/admin-delete-lot.php",data:{lotId:t},method:"post",error:function(){x(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){x(!1),e.remove()}})}),w.submit(function(t){var e=$(this).find(".form-item"),a=e.has("input:checked"),i=$("#sellers"),n=a.length;if(0==n)alert("Жодного продавця не вибрано!"),t.preventDefault();else{var s="";a.each(function(t){s+=$(this).children(".seller").text(),t!=n-1&&(s+=",")}),i.val(s)}})},loading=function(t){var e=$("#loading");switch(t){case!0:e.show(0,function(){e.css({display:"flex"})});break;case!1:e.hide();break;default:alert("Сталася помилка! Сторінку буде перезавантажено!"),window.location.reload()}},verify=function(t,e){var a=t.parents("td"),i=a.siblings(".id").text(),n=t.children(".set-trader-id").val(),s=a.siblings(".delete").children(".cancel-verification-button"),l=a.siblings(".access").children(".allow-access"),r=$("body");loading(!0),$.ajax({url:"scripts/php/admin-verify.php",dataType:"html",method:"POST",data:{id:i,traderId:n},success:function(t){loading(!1),r.prepend(t),s.removeAttr("disabled"),l.removeAttr("disabled")},error:function(){loading(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()}}),e.preventDefault()},denyAccess=function(t){var e=t.parentsUntil("tbody"),a=e.children(".id").text(),i=e.children(".access");loading(!0),$.ajax({url:"scripts/php/admin-deny-access.php",method:"POST",data:{id:a},dataType:"html",success:function(t){i.html(t),alert("Користувачу заборонено доступ до торгів.")},error:function(){alert("Не вдалося з'єднатися з базою даних!")},complete:function(){loading(!1)}})},allowAccess=function(t){if(!t.is(":disabled")){var e=t.parentsUntil("tbody"),a=e.children(".id").text(),i=e.children(".access");loading(!0),$.ajax({url:"scripts/php/admin-allow-access.php",method:"POST",data:{id:a},dataType:"html",success:function(t){i.html(t),alert("Користувача успішно допущено до торгів.")},error:function(){alert("Не вдалося з'єднатися з базою даних!")},complete:function(){loading(!1)}})}};$(document).ready(main);