"use strict";var main=function(){var e=$(".navbar").height(),t=$("main"),a=$("table.users, table.lots"),i=$("header .navbar button"),n=$(".users td.ver"),r=n.children(".verification-form"),s=$(".users td.delete .delete-button"),l=$(".users td.delete .cancel-verification-button"),o=$("#cancel-all-verifications #cancel"),c=$(".lots td.delete .delete-button"),d=$("#upload"),p=$("#clear-lots"),u=$("#total"),h=$("#total-verified"),f={nextSession:$("#set-next-session"),adminPass:$("#set-admin-pass")},m=function(e){var t=$("#loading");switch(e){case!0:t.show(0,function(){t.css({display:"flex"})});break;case!1:t.hide();break;default:alert("Сталася помилка! Сторінку буде перезавантажено!"),window.location.reload()}},v=function(e,t){m(!0),$.ajax({url:"scripts/php/admin-settings.php",method:"POST",data:{function:e,input:t},success:function(){alert("Налаштування змінено!")},error:function(){alert("Щось пішло не так! Налаштування не було змінено!")},complete:function(){m(!1)}})},b=$("form .content"),x=b.children(".add-paragr"),g=$(".trade");t.css("margin-top",e+20+"px"),a.DataTable({iDisplayLength:10}),i.click(function(){var e=$(".page-maker"),t=$('[id$="_wrapper"]'),a=$(this).attr("id"),i=$("#DataTables_Table_1_wrapper"),n=$("#DataTables_Table_0_wrapper");switch(e.hide(),t.hide(),$("."+a).toggle(),a){case"users":i.show();break;case"lots":n.show()}}),f.nextSession.submit(function(e){var t=$("#next-session").val();e.preventDefault(),v("nextSession",t)}),f.adminPass.submit(function(){var e=$("#admin-pass").val();event.preventDefault(),v("adminPass",e)}),d.change(function(){var e=this.files[0];if(e.name.length>0){var t=new FormData;t.append("lots",e),m(!0),$.ajax({url:"scripts/php/admin-upload-lots.php",method:"POST",data:t,contentType:!1,processData:!1,success:function(){alert("Лоти успішно оновлено!")},error:function(){alert("Проблема з файлом! Таблицю не буде оновлено!")},complete:function(){m(!1)}}),d.val("")}else alert("Ви не вибрали файл, таблицю не буле оновлено!"),m(!1)}),p.click(function(){m(!0),$.ajax({url:"scripts/php/admin-clear-lots.php",success:function(){alert("Таблицю лотів успішно очищено!")},error:function(){alert("Виникла проблема. Не вдалося очистити лоти.")},complete:function(){m(!1)}})}),r.on("submit",function(e){var t=$(this).parents("td"),a=t.siblings(".id").text(),i=$(this).children(".set-trader-id").val(),n=$("body");return m(!0),$.ajax({url:"scripts/php/admin-verify.php",dataType:"html",method:"POST",data:{id:a,traderId:i},success:function(e){m(!1),n.prepend(e)},error:function(){m(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()}}),e.preventDefault()}),s.click(function(){var e=$(this).parent().siblings(".id").text(),t=$(this).parentsUntil("tbody"),a=t.siblings(".ver").text();m(!0),$.ajax({url:"scripts/php/admin-delete-user.php",data:{userId:e},method:"post",error:function(){m(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){m(!1),t.remove(),u.text(parseInt(u.text()-1)),"Верифікований"==a&&h.text(parseInt(h.text())-1)}})}),l.click(function(){var e=$(this).parentsUntil("tbody"),t=e.children(".id").text(),a=e.children(".trader-id"),i=e.children(".ver"),n=e.children(".applied-for-lots");m(!0),$.ajax({url:"scripts/php/admin-cancel-verification.php",method:"POST",data:{id:t},success:function(){a.empty(),i.html('<form class="verification-form"><input type="text" name="set-trader-id" class="set-trader-id" maxlength="4" pattern="[0-9]{3}" placeholder="Реєстр. №"><label class="verify">Верифікувати<input style="display: none;" type="submit" name="submit" value="verify"></label></form>'),h.text(parseInt(h.text())-1),n.empty()},error:function(){alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},complete:function(){m(!1)}})}),o.click(function(){var e=$(".users td.trader-id"),t=$(".users td.ver");m(!0),$.ajax({url:"scripts/php/admin-cancel-all-verifications.php",success:function(){e.empty(),t.html('<form class="verification-form"><input type="text" name="set-trader-id" class="set-trader-id" maxlength="4" pattern="[0-9]{3}" placeholder="Реєстр. №"><label class="verify">Верифікувати<input style="display: none;" type="submit" name="submit" value="verify"></label></form>'),h.text("0")},error:function(){alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},complete:function(){m(!1)}})}),c.click(function(){var e=$(this).parent().siblings(".id").text(),t=$(this).parentsUntil("tbody");m(!0),$.ajax({url:"scripts/php/admin-delete-lot.php",data:{lotId:e},method:"post",error:function(){m(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()},success:function(){m(!1),t.remove()}})}),x.click(function(){var e=$(".content textarea").val(),t=b.children("textarea"),a=$(".clear"),i=$(".watch");""!==e&&(b.append('<div class="new-paragr"><button class="remove-paragr" type="button">Стерти</button><button class="edit-paragr" type="button">Редаг</button><button type="button" class="edited">OK</button><p class="paragraph">'+e+"</p></div>"),t.val(""));var n=$(".content .new-paragr"),r=n.children(".edit-paragr"),s=n.children(".edited"),l=n.children(".remove-paragr");a.click(function(){t.val("")}),r.unbind().on("click",function(){var e=$(this),t=e.siblings("p").html(),a=e.siblings("textarea, p"),i=e.siblings(".edited");a.remove(),e.parent().prepend('<textarea autofocus rows="12" tabindex="1">'+t+"</textarea>"),e.hide(),i.show(),e.siblings("textarea").focus()}),s.click(function(){var e=$(this),t=e.siblings("textarea").text();""!==t&&(e.siblings("p").remove(),e.parent().append("<p>"+t+"</p>"),e.hide(),e.siblings("textarea").remove(),e.siblings(".edit-paragr").show())}),l.click(function(){$(this).parent().remove()}),i.on("click",function(){var e=$("#header"),t=e.val(),a="<h2>"+t+"</h2>",i="";if(n.each(function(){i=i+"<p>"+$(this).children("p").html()+"</p>"}),0!==n.length&&""!==t){var r="<article class='preview'><span class='back' style='color: grey; float: right;'>Повернутись - подвійний клік по статті</span>"+a+i+"</article>",s=$("article.preview"),l=$("fieldset");l.hide(),s.remove(),$("form.write-article").append(r)}else if(""==t)return e.toggleClass("error"),!1;$("article").focus(),s.dblclick(function(){$(this).remove(),l.show()})})}),g.submit(function(e){var t=$(this).find(".form-item"),a=t.has("input:checked"),i=$("#sellers"),n=a.length;if(0==n)alert("Жодного продавця не вибрано!"),e.preventDefault();else{var r="";a.each(function(e){r+=$(this).children(".seller").text(),e!=n-1&&(r+=",")}),i.val(r)}})};$(document).ready(main);