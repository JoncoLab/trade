"use strict";var main=function(){var t=$(".navbar").css("height");$("main").css({"margin-top":t,"padding-top":t}),$("table.users, table.lots").DataTable({iDisplayLength:10}),$("header .navbar button").click(function(){$(".page-maker").hide(),$('[id$="_wrapper"]').hide();var t=$(this).attr("id");switch($("."+t).toggle(),t){case"users":$("#DataTables_Table_1_wrapper").show();break;case"lots":$("#DataTables_Table_0_wrapper").show()}});var e=function(){return"Верифікований"===$(this).text()?null:'<form class="verification-form"><input type="text" name="set-trader-id" class="set-trader-id" maxlength="4" pattern="[0-9]{3}" placeholder="Реєстр. №"><label class="verify">Верифікувати<input style="display: none;" type="submit" name="submit" value="verify"></label></form>'};$(".users td.ver").append(e),$(".users .verification-form").on("submit",function(){var t=$(this).parents("td"),e=t.siblings(".id").text(),a=$(this).children(".set-trader-id").val(),r=function(t){var e=$("#loading");switch(t){case!0:e.show(),e.css({display:"flex"});break;case!1:e.hide();break;default:alert("Сталася помилка! Сторінку буде перезавантажено!"),window.location.reload()}};return r(!0),$.ajax({url:"scripts/php/admin-verify.php",dataType:"html",method:"POST",data:{id:e,traderId:a},success:function(t){r(!1),$("body").prepend(t)},error:function(){r(!1),alert("Не вдається з'єднатися з базою даних! Сторінку буде перезавантажено!"),window.location.reload()}}),!1}),$("form .content .add-paragr").click(function(){var t=$(".content textarea").val();""!==t&&($(".content").append('<div class="new-paragr"><button class="remove-paragr" type="button">Стерти</button><button class="edit-paragr" type="button">Редаг</button><button type="button" class="edited">OK</button><p class="paragraph">'+t+"</p></div>"),$(".content > textarea").val("")),$(".clear").click(function(){$(".content >textarea").val("")}),$(".edit-paragr").unbind().on("click",function(){var t=$(this).siblings("p").html();$(this).siblings("textarea").remove(),$(this).parent().prepend('<textarea autofocus rows="12" tabindex="1">'+t+"</textarea>"),$(this).siblings("p").remove(),$(this).hide(),$(this).siblings(".edited").show(),$(this).siblings("textarea").focus()}),$(".content .new-paragr .edited").click(function(){var t=$(this).siblings("textarea").text();""!==t&&($(this).siblings("p").remove(),$(this).parent().append("<p>"+t+"</p>"),$(this).hide(),$(this).siblings("textarea").remove(),$(this).siblings(".edit-paragr").show())}),$(".content .new-paragr .remove-paragr").click(function(){$(this).parent().remove()}),$(".watch").on("click",function(){var t="<h2>"+$("#header").val()+"</h2>",e="";if($(".new-paragr").each(function(){e=e+"<p>"+$(this).children("p").html()+"</p>"}),0!==$(".new-paragr").length&&""!==$("#header").val()){var a="<article class='preview'> <span class='back' style='color: grey; float: right;'>повернутись - подвійний клік по статті</span>"+t+e+"</article>";$("fieldset").hide(),$("article.preview").remove(),$("form.write-article").append(a)}else if(""==$("#header").val())return $("#header").toggleClass("error"),!1;$("article").focus(),$("article.preview").dblclick(function(){$(this).remove(),$("fieldset").show()})})})},startTrade=function(){var t=0,e=$(".trade button.add-step"),a=$(".trade button.remove-step"),r=$(".trade button.next-lot"),s=$(".trade button.previous-lot"),i=$(".trade button.end-trade"),n=$(".trade .set-final-cost button"),c=$("#set-final-cost"),d=$(".trade td.current-step"),o=parseInt($(".trade td.step").text()),l=parseInt($(".trade td.size").text()),p=parseInt($(".trade td.cost-start").text()),h=$(".trade td.cost-final"),u=$(".trade td.price-final"),x=$(".trade td.id").text(),b=$(".trade td.type").text(),f=$(".trade td.breed").text(),v=$(".trade .admin-info"),m=$(".trade td.customers-applied"),g=$(".trade td.customer-number"),w=function(){var t=parseInt(d.text()),e=p+t*o,a=e*l;h.text(e),u.text(a)},k=function(t){$(".trade td.seller-name").text(lots[t].sellerName),$(".trade td.id").text(lots[t].id),$(".trade td.type").text(lots[t].type),$(".trade td.characteristics-diametr").text(lots[t].characteristicsDiametr),$(".trade td.characteristics-sort").text(lots[t].characteristicsSort),$(".trade td.breed").text(lots[t].breed),$(".trade td.characteristics-length").text(lots[t].characteristicsLength),$(".trade td.characteristics-storage").text(lots[t].characteristicsStorage),$(".trade td.gost").text(lots[t].gost),$(".trade td.size").text(lots[t].size),$(".trade td.customers-applied").text(lots[t].customersApplied),$(".trade td.cost-start").text(lots[t].costStart),$(".trade td.step").text(lots[t].step),d.text(0),x=$(".trade td.id").text(),b=$(".trade td.type").text(),f=$(".trade td.breed").text(),l=parseInt($(".trade td.size").text()),p=parseInt($(".trade td.cost-start").text())},y=function(){if(""!==m.text().trim()){var t=m.text().split(", "),e="";t.forEach(function(a,r){e+='<span class="customer">'+a+"</span>",r===t.length-1?e+=";":e+=", "}),m.html(e);m.children(".customer").click(function(){var t=$(this).text();g.text(t)})}c.attr({min:p,value:p,step:o}),v.text("№"+x+", "+b+", "+f+", "+l+" куб., "+p+" грн.")},I=function(){var t=parseInt(d.text()),e=t+1;d.text(e),w()},T=function(){var t=parseInt(d.text()),e=0===t?0:t-1;d.text(e),w()},_=function(){var t=parseInt(c.val())>=parseInt(c.attr("min"))?parseInt(c.val()):parseInt(c.attr("min")),e=Math.ceil((t-p)/o),a=t*l;h.text(t),d.text(e),u.text(a)},D=function(){t>=lots.length-1?t=lots.length-1:t++,k(t),w(),y()},z=function(){t<=0?t=0:t--,k(t),w(),y()},S=function(){$(".trade *").hide(),$(".trade .start-trade").show()};w(),y(),e.click(I),a.click(T),r.click(D),s.click(z),i.click(S),n.click(_),$(document).keydown(function(t){switch(t.which){case 107:I();break;case 109:T();break;case 13:S();break;case 111:z();break;case 106:D()}}),$(".trade *:not(.start-trade):not(script)").show()};$(document).ready(main);